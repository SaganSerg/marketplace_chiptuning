var dictionary = {
    'Car' : {
        'en': 'Car',
        'ru': 'Автомобиль'
    },
    'Marine': {
        'en': 'Marine',
        'ru': 'Лодки'
    }
}
var listVehicles = {
    'Car' : {
        'ABARTH' : [
            'Liste Disi',
            '124 SPIDER',
            '500 NEW 2007',
            '500 NEW 2010',
            '595 COMPETIZIONE',
            '595 TURISMO',
            '695',
            'PUNTO EVO',
            'PUNTO GRANDE'
        ],
        'ACURA' : [
            'Liste Disi',
            'RDX',
            'TSX',
        ],
        'AGRALE' : [
            'Liste Disi'
        ],
        'ALFA ROMEO' : [
            'Liste Disi',
            '145',
            '146',
            '147',
            '156 Mk1',
            '156 Mk2',
            '159',
            '166',
            '4C',
            '8C',
            'BRERA',
            'GIULIA',
            'GIULIETTA',
            'GT',
            'GTV',
            'MITO',
            'SPIDER',
            'STELVIO',
        ],
        'ALPINA' : [
            'Liste Disi',
            'B3',
            'B4',
            'B5',
            'B6',
            'B7',
            'D3',
            'D5',
            'ROADSTER S',
            'XD3',
        ],
        'ALPINE' : [
            'Liste Disi',
        ],
        'ASTON MARTIN' : [
            'Liste Disi',
            'DB11',
            'DB9',
            'RAPIDE',
            'VANQUISH',
            'VANTAGE',
        ],
        'AUDI' : [
            'Liste Disi',
            'A1 (8X)',
            'A2 (8Z)',
            'A3 (8L)',
            'A3 (8P)',
            'A3 (8P) MY 2008',
            'A3 (8V)',
            'A4 (B5)',
            'A4 (B6)',
            'A4 (B7)',
            'A4 (B8)',
            'A4 (B9)',
            'A5 (8F/8T)',
            'A5 (8F/8T) MY 2012',
            'A5 (9T)',
            'A6 (C4)',
            'A6 (C5)',
            'A6 (C6)',
            'A6 (C7)',
            'A6 (C8)',
            'A7 (4G)',
            'A7 (4K)',
            'A8 (D2)',
            'A8 (D3)',
            'A8 (D4)',
            'A8 (D5)',
            'ALLROAD',
            'Q2',
            'Q3 (8UB)',
            'Q5 (8RB)',
            'Q7 (4LB)',
            'Q7 (4M)',
            'Q8',
            'R8 (42)',
            'R8 (42) MY 2012',
            'R8 (4S)',
            'RS3 (8P)',
            'RS3 (8V)',
            'RS4 (8D)',
            'RS4 (8K)',
            'RS4 (9B)',
            'RS5 (8T)',
            'RS5 (9T)',
            'RS6 (4B)',
            'RS6 (4F)',
            'RS6 (4G)',
            'RS7 (4G)',
            'RSQ3 (8UB)',
            'S1 (8X)',
            'S3 (8L)',
            'S3 (8P)',
            'S3 (8V)',
            'S4 (8D)',
            'S4 (8E)',
            'S4 (8H)',
            'S4 (8K)',
            'S5 (8T)',
            'S6 (4B)',
            'S6 (4F)',
            'S6 (4G)',
            'S7 (4G)',
            'S8 (4D)',
            'S8 (4E)',
            'S8 (4H)',
            'SQ5 (8RB)',
            'TT (8J)',
            'TT (8N)',
            'TT (8S)',
        ],
        'BAIC' : [
            'Liste Disi',
            'D20',
            'SENOVA',
            'X25',
            'X65',	            
        ],
        'BENTLEY' : [
            'Liste Disi',
            'ARNAGE',
            'BENTAYGA',
            'CONTINENTAL GT',
            'CONTINENTAL GT 2011',
            'CONTINENTAL GT 2012',
            'CONTINENTAL GT SPEED',
            'CONTINENTAL GTC',
            'FLYING SPUR',
            'MULSANNE',
        ],
        'BMC' : [
            'Liste Disi',
            'MEGASTAR',
        ],
        'BMW' : [
            'Liste Disi',
            '1 SERIES E81/E82/E87/E88',
            '1 SERIES F20/F21',
            '2 SERIES F22/F45/F46',
            '3 SERIES E36',
            '3 SERIES E46',
            '3 SERIES E90/E91/E92/E93',
            '3 SERIES F30/F31/F35',
            '3 SERIES G20',
            '3 SERIES GT F34',
            '4 SERIES F32/F33/F36',
            '5 SERIES E39',
            '5 SERIES E60/E61',
            '5 SERIES F10/F11/F18',
            '5 SERIES G30/G31/G38',
            '5 SERIES GT F07',
            '6 SERIES E63/E64',
            '6 SERIES F12/F13',
            '6 SERIES GT G32',
            '7 SERIES E38',
            '7 SERIES E65/E66/E67',
            '7 SERIES F01/F02/F03/F04',
            '7 SERIES G11/G12',
            '8 SERIES E31',
            'i8',
            'M2 SERIES F87',
            'M3 SERIES E36',
            'M3 SERIES E46',
            'M3 SERIES E90/E92/E93',
            'M3 SERIES F80',
            'M4 SERIES F82/F83',
            'M5 SERIES E39',
            'M5 SERIES E60/E61',
            'M5 SERIES F10/F18',
            'M5 SERIES F90',
            'M6 SERIES E63/E64',
            'M6 SERIES F06/F12/F13',
            'X1 SERIES E84',
            'X1 SERIES F48/F49',
            'X2 SERIES F39',
            'X3 SERIES E83/E83 LCI',
            'X3 SERIES F25',
            'X3 SERIES G01',
            'X4 SERIES F26',
            'X4 SERIES G02',
            'X5 SERIES E53',
            'X5 SERIES E70',
            'X5 SERIES F15',
            'X5 SERIES G05',
            'X5 SERIES M F85',
            'X6 SERIES E71',
            'X6 SERIES F16',
            'X6 SERIES M F86',
            'Z3 SERIES E36',
            'Z3 SERIES M E36',
            'Z4 SERIES E85/E86',
            'Z4 SERIES E89',
            'Z4 SERIES G29',
            'Z4 SERIES M E85/E86',
            'Z8 SERIES E52',
        ],
        'BONETTI' : [
            'Liste Disi',
            'F100X',
        ],
        'BREMACH' : [
            'Liste Disi',
            'EXTREME',
            'TGR35',
            'TGR60',
        ],
        'BRILLIANCE AUTO GROUP' : [
            'Liste Disi',
            'FRV (JUNJIE)',
            'V5',
        ],
        'BUICK' : [
            'Liste Disi',
            'ENCLAVE',
            'ENCORE',
            'ENVISION',
            'EXCELLE',
            'GL8',
            'LACROSSE 2005-2009',
            'LACROSSE 2010-',
            'REGAL MK5',
            'VERANO',
        ],
        'CADILLAC' : [
            'Liste Disi',
            'ATS',
            'BLS',
            'CTS',
            'DTS',
            'ESCALADE',
            'SLS',
            'SRX',
            'XTS',
        ],
    },
    'Marine' : {
        'AERMARINE' : [
            'Liste Disi',
        ],
        'CUMMINS MARINE' : [
            'Liste Disi',
            'QSB',
            'QSM',
        ],
    }
};
var listServices = {
    'Car' : {
        'EGR OFF': 60,
        'CAT OFF': 60,
        'GUC ARTRIMA/MOD': 90,
        'OTHERS/Diger Hizmetler': 0,
        'Checksum Correction': 60,
        'DPF OFF': 60,
        'SCR/Adblue OFF': 200,
        'Speed Limit': 90,
        'DTC OFF': 60,
        'ORI File Request': 30,
    },
    'Marine': {
        'SCR/Adblue OFF': 200,
        'EGR OFF': 200,
        'DTC OFF': 100,
        'OTHERS/Diger Hizmetlermix': 0,
        'DPF OFF': 200,
        'MOD': 300,
        'Checksum Correction': 100,
        'ORI File Request': 100,
    }
}
// Этот набор данный нужет для того, чтобы подставить свой список услуг для каждого транспорта
function hideBlockSelect(idBlock) {
    document.getElementById(idBlock).classList.add('hide');
}
function showBlockSelect(idBlock) {
    document.getElementById(idBlock).classList.remove('hide');
}
function getText(place) {
    if (idBlockForGettingLang) {
        let lang;
        if (lang = getLang(idBlockForGettingLang)) {
            return dictionary[place][lang];
        }
    }
    return '/.../';
}

function getLang(id) {
    let elem;
    if (elem = document.getElementById(id)) {
        return elem.dataset.lang;
    }
}
function getInitialOptionElement()
{
    return `<option disabled selected value="initial-state">Выберите тип транспортного средства</option>`;
}
function printVehicleOptions() {
    let htmlOptions = `<option disabled selected value="initial-state">Выберите тип транспортного средства</option>`;
    for (let prop in listVehicles) {
        if (!listVehicles.hasOwnProperty(prop)) continue;
        console.log(getText(prop));
        htmlOptions += `<option>${prop}</option>`;
    }
    document.getElementById('vehicle-type').innerHTML = htmlOptions;
}

function printBrandOptions(vehicle) {
    let htmlOptions = `<option disabled selected value="initial-state">Выберите бренд транспортного средства</option>`;
    for (let prop in listVehicles[vehicle]) {
        if (!listVehicles[vehicle].hasOwnProperty(prop)) continue;
        htmlOptions += `<option>${prop}</option>`;
    }
    document.getElementById('vehicle-brand').innerHTML = htmlOptions;
}
function printModelOptions(vehicle, brand) {
    let htmlOptions = `<option disabled selected value="initial-state">Выберите модель транспортного средства</option>`;
    for (let prop in listVehicles[vehicle][brand]) {
        if (!listVehicles[vehicle][brand].hasOwnProperty(prop)) continue;
        htmlOptions += `<option>${listVehicles[vehicle][brand][prop]}</option>`;
    }
    document.getElementById('vehicle-model').innerHTML = htmlOptions;
}
(function() {
    window.addEventListener('load', function() {
        if (document.querySelector('body.page_cabinet')) { // этот блок онтоситься к странице кабинет
            let hideShowButton = document.getElementById('hide-show-button'); // доступ к "бутерброду"
            let mainNav = document.getElementById('main-nav'); // доступ к сайдбару
            let mainNavHideShow = document.getElementById('main-nav-hide'); // доступ к крестику на сайдбаре
            function toggleHideShow() { // данная функция переключает у сайдабара класс, который показывает и скрывает сайдбар
                mainNav.classList.toggle('page__nav_hide-show');
            }
            function addEventHideShow (button) { // данная функция навешивает на элементы, событие по которому скрывается-показывается сайдбар
                button.addEventListener('click', toggleHideShow );
            }
            if (mainNav) { // данное условие нужно на всякий случай
                if (hideShowButton) { // данное условие нужно для подстаховки
                    addEventHideShow(hideShowButton);
                }
                if (mainNavHideShow) { // данное условие нужно для подстраховки
                    addEventHideShow(mainNavHideShow);
                }
            }
        }
        if (document.querySelector('article.content_choice-file__last')) {
            document.getElementById('form_treatment_file').addEventListener('submit', function (env) {
                env.preventDefault();
            });
            document.getElementById('submit-file').addEventListener('click', function (){
                document.getElementById('form_treatment_file').submit();
            });
            // printVehicleOptions();
            // addEventButtonNext('type', 'brand');
            // addEventButtonNext('brand', 'model');
            // addEventButtonNext('model', 'details');
            // addEventButtonNext('details', 'block-select-options', true);
            fileDownloadingManagement();
            goAroundCheckboxes(addEventCheckboxes);
        }
        if (document.querySelector('article.content_big_file')) {
            fileDownloadingManagement();
        }
        if (document.querySelector('article.content-provider_deal')) {
            fileDownloadingManagementProvider();
        }
    });
})();
function fileDownloadingManagementProvider() {
    document.getElementById('treated-file').addEventListener('change', function(){
        var file = this.files[0];
        var reader = new FileReader();
        reader.readAsArrayBuffer(file);
        reader.onload = function() {
            var result = reader.result;
            var view = new Uint8Array(result);
            document.getElementById('checksum-treated-file').value = crc16MODBUS(view);
        }
    });
}
function fileDownloadingManagement() {
    document.getElementById('vehicle-original-file').addEventListener('change', function() {
        var file = this.files[0];
        var reader = new FileReader();
        reader.readAsArrayBuffer(file);
        reader.onload = function () {
            var result = reader.result;
            var view = new Uint8Array(result);
            document.getElementById('checksum').value = crc16MODBUS(view);
            document.getElementById('submit-file').classList.remove('hide');
        }
    });
}
// function addEventButtonNext(currentType, purposeType, fullNamePurposeClass) {
//     document.getElementById('button-next-vehicle-' + currentType).addEventListener('click', function() {
//         const VALUE_VEHICLE_TYPE = document.getElementById('vehicle-' + currentType).value;
//         const SELECTED_TYPE = document.getElementById('selected-' + currentType);
//         const BLOCK_LIST_SERVICES = document.getElementById('block_list_services');
//         if ((VALUE_VEHICLE_TYPE !== 'initial-state') && (VALUE_VEHICLE_TYPE != '')) {
//             SELECTED_TYPE.innerText = VALUE_VEHICLE_TYPE;
//             hideBlockSelect('block-vehicle-' + currentType);
//             if (fullNamePurposeClass) {
//                 showBlockSelect(purposeType);
//             } else {
//                 showBlockSelect('block-vehicle-' + purposeType);
//             }
//             if (purposeType == 'brand') {
//                 printBrandOptions(VALUE_VEHICLE_TYPE);
//             } else if (purposeType == 'model') {
//                 const VALUE_TYPE = document.getElementById('vehicle-type').value;
//                 printModelOptions(VALUE_TYPE, VALUE_VEHICLE_TYPE);
//             }
//             if (currentType == 'type') {
//                 let html = '';
//                 for (let prop in listServices[VALUE_VEHICLE_TYPE]) {
//                     if (!listServices[VALUE_VEHICLE_TYPE].hasOwnProperty(prop)) continue;
//                     html += 
//                     '<label class="block-checkboxes__block-checkbox block-checkbox"><input type="checkbox" name="' + prop.replace(' ', '_').replace('/', '_').toLowerCase() +'" value="1">' + prop + '<span class="block-checkbox__price">' + listServices[VALUE_VEHICLE_TYPE][prop] +'</span></label>';
//                 }
//                 BLOCK_LIST_SERVICES.innerHTML = html;
//                 goAroundCheckboxes(addEventCheckboxes);
//             }
//         }
//     });
// }
function goAroundCheckboxes(fun) {
    const listLabels = document.getElementById('block_list_services').childNodes;
    for (let label in listLabels) {
        if (listLabels.hasOwnProperty(label)) {
            if (listLabels[label].nodeType == 1) {
                let child = listLabels[label].childNodes[0];
                if (child.attributes.type.nodeValue == 'checkbox') {
                    fun(child);
                }
            }
        }
    }
}
function addEventCheckboxes(elem) {
    elem.addEventListener('change', sumTotal);
}
function sumTotal () {
    sum = 0;
    goAroundCheckboxes(function (elem) {
        if (elem.checked) {
            sum += Number(elem.nextElementSibling.textContent);
        }
    });
    document.getElementById("total-sum").innerHTML = sum;
    document.getElementById('total-sum-input').setAttribute('value', sum);
}
function crc16MODBUS(string){
    var CrcTable = [
        0X0000, 0XC0C1, 0XC181, 0X0140, 0XC301, 0X03C0, 0X0280, 0XC241,
        0XC601, 0X06C0, 0X0780, 0XC741, 0X0500, 0XC5C1, 0XC481, 0X0440,
        0XCC01, 0X0CC0, 0X0D80, 0XCD41, 0X0F00, 0XCFC1, 0XCE81, 0X0E40,
        0X0A00, 0XCAC1, 0XCB81, 0X0B40, 0XC901, 0X09C0, 0X0880, 0XC841,
        0XD801, 0X18C0, 0X1980, 0XD941, 0X1B00, 0XDBC1, 0XDA81, 0X1A40,
        0X1E00, 0XDEC1, 0XDF81, 0X1F40, 0XDD01, 0X1DC0, 0X1C80, 0XDC41,
        0X1400, 0XD4C1, 0XD581, 0X1540, 0XD701, 0X17C0, 0X1680, 0XD641,
        0XD201, 0X12C0, 0X1380, 0XD341, 0X1100, 0XD1C1, 0XD081, 0X1040,
        0XF001, 0X30C0, 0X3180, 0XF141, 0X3300, 0XF3C1, 0XF281, 0X3240,
        0X3600, 0XF6C1, 0XF781, 0X3740, 0XF501, 0X35C0, 0X3480, 0XF441,
        0X3C00, 0XFCC1, 0XFD81, 0X3D40, 0XFF01, 0X3FC0, 0X3E80, 0XFE41,
        0XFA01, 0X3AC0, 0X3B80, 0XFB41, 0X3900, 0XF9C1, 0XF881, 0X3840,
        0X2800, 0XE8C1, 0XE981, 0X2940, 0XEB01, 0X2BC0, 0X2A80, 0XEA41,
        0XEE01, 0X2EC0, 0X2F80, 0XEF41, 0X2D00, 0XEDC1, 0XEC81, 0X2C40,
        0XE401, 0X24C0, 0X2580, 0XE541, 0X2700, 0XE7C1, 0XE681, 0X2640,
        0X2200, 0XE2C1, 0XE381, 0X2340, 0XE101, 0X21C0, 0X2080, 0XE041,
        0XA001, 0X60C0, 0X6180, 0XA141, 0X6300, 0XA3C1, 0XA281, 0X6240,
        0X6600, 0XA6C1, 0XA781, 0X6740, 0XA501, 0X65C0, 0X6480, 0XA441,
        0X6C00, 0XACC1, 0XAD81, 0X6D40, 0XAF01, 0X6FC0, 0X6E80, 0XAE41,
        0XAA01, 0X6AC0, 0X6B80, 0XAB41, 0X6900, 0XA9C1, 0XA881, 0X6840,
        0X7800, 0XB8C1, 0XB981, 0X7940, 0XBB01, 0X7BC0, 0X7A80, 0XBA41,
        0XBE01, 0X7EC0, 0X7F80, 0XBF41, 0X7D00, 0XBDC1, 0XBC81, 0X7C40,
        0XB401, 0X74C0, 0X7580, 0XB541, 0X7700, 0XB7C1, 0XB681, 0X7640,
        0X7200, 0XB2C1, 0XB381, 0X7340, 0XB101, 0X71C0, 0X7080, 0XB041,
        0X5000, 0X90C1, 0X9181, 0X5140, 0X9301, 0X53C0, 0X5280, 0X9241,
        0X9601, 0X56C0, 0X5780, 0X9741, 0X5500, 0X95C1, 0X9481, 0X5440,
        0X9C01, 0X5CC0, 0X5D80, 0X9D41, 0X5F00, 0X9FC1, 0X9E81, 0X5E40,
        0X5A00, 0X9AC1, 0X9B81, 0X5B40, 0X9901, 0X59C0, 0X5880, 0X9841,
        0X8801, 0X48C0, 0X4980, 0X8941, 0X4B00, 0X8BC1, 0X8A81, 0X4A40,
        0X4E00, 0X8EC1, 0X8F81, 0X4F40, 0X8D01, 0X4DC0, 0X4C80, 0X8C41,
        0X4400, 0X84C1, 0X8581, 0X4540, 0X8701, 0X47C0, 0X4680, 0X8641,
        0X8201, 0X42C0, 0X4380, 0X8341, 0X4100, 0X81C1, 0X8081, 0X4040
    ];

    var crc = 0xFFFF;

    for(var i = 0, l = string.length ; i < l; i++){
        crc = ((crc >> 8) ^ CrcTable[(crc ^ string[i]) & 0xFF]);
        
    };
    return crc.toString(16);
}

